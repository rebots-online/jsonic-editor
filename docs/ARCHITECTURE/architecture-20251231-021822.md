# Architecture Plan (2025-12-31 02:18:22 UTC)

## Repository Snapshot (Abstracted AST Overview)
- **App (`jsonic/src/App.tsx`)**
  - Maintains React state: `currentView`, `graph: JsonGraph`, `textContent`, `currentFile`, `status`.
  - Uses toolbar, graph, text editor, and status bar components.
  - Sync utilities: `jsonToGraph`, `graphToJson` from `utils/jsonParser`.
- **GraphView (`jsonic/src/components/GraphView.tsx`)**
  - Functional component rendering Cytoscape graph from `JsonGraph` nodes/edges.
  - Props: `graph`, `onNodeSelect`, `onNodeEdit`, `onNodeCreate`, `onNodeDelete`, `onNodeMove`.
  - Initializes Cytoscape layout (`breadthfirst`) and registers simple tap handler to select nodes.
- **Types (`jsonic/src/types/jsonTypes.ts`)**
  - `JsonNode` shape with id, type, optional key/value/children/parent/position/comments.
  - `JsonGraph` containing nodes, edges (parent/sibling), metadata.
- **JSON Parser Utils (`jsonic/src/utils/jsonParser.ts`)**
  - Converters between JSON value and `JsonGraph` (bidirectional).
  - Helpers: `findNode`, `addChildNode`, `updateNode` (no delete/move helpers yet).
- **UI Components**
  - Toolbar, TextEditor, StatusBar are present for layout and file operations.

## Proposed Solution (Eventful Graph Editing & Navigation)
1. **GraphView Interaction Layer**
   - Expose rich Cytoscape event hooks:
     - Node **double-tap/double-click** → trigger `onNodeEdit` with `{ id, key, value, type, position }` payload.
     - **Context menu** on node and background → show native `contextmenu` with options (edit, create child, delete, move) via callback payloads.
     - **Drag-and-drop** node moves → on grab/free events capture start/end positions and parent relationship changes, fire `onNodeMove`.
     - **Zoom/pan** events → provide `onViewportChange`-like payload to maintain stable layout (tracking `position`, `zoom`, `pan`).
   - Maintain selection highlighting and keyboard focus mapping (Tab/Shift+Tab cycling nodes, Ctrl+Arrow for parent/child/sibling travel).
2. **App State Mutation**
   - Implement callbacks to mutate `graph` using utility helpers:
     - Add utility helpers for delete, move, connect edges (extend `jsonParser.ts`).
     - Keep node `position` to preserve layout during edits.
     - Re-sync text view after mutations via `graphToJson`.
   - Confirm deletion actions before mutating state.
3. **Context Menus & Keyboard Shortcuts**
   - Provide at least one actionable context menu (e.g., on node: Edit, Add Child, Delete with confirmation, Center View).
   - Keyboard navigation: Tab/Shift+Tab to iterate nodes; Ctrl+Arrow to navigate relationally.

## Diagrams

### Component Interaction (Mermaid UML Class Diagram)
```mermaid
classDiagram
  class App {
    state graph: JsonGraph
    state currentView
    +handleOpenFile()
    +handleSaveFile()
    +onGraphNodeEdit()
    +onGraphNodeCreate()
    +onGraphNodeDelete()
    +onGraphNodeMove()
  }
  class GraphView {
    +render Cytoscape graph
    +emit node selection/edit/create/delete/move events
    +handle keyboard shortcuts
  }
  class jsonParser {
    +jsonToGraph()
    +graphToJson()
    +addChildNode()
    +updateNode()
    +removeNode()
    +moveNode()
  }
  App --> GraphView : props
  App --> jsonParser : utilities
  GraphView --> App : event callbacks
```

### State & Event Flow (Mermaid Sequence)
```mermaid
sequenceDiagram
  participant User
  participant GraphView
  participant App
  participant jsonParser

  User->>GraphView: Double-click node
  GraphView-->>App: onNodeEdit({ id, key, value, type, position })
  App->>jsonParser: updateNode(graph, id, updates)
  jsonParser-->>App: updated graph
  App-->>GraphView: setGraph(updated)
  App-->>TextEditor: setTextContent(graphToJson(updated))

  User->>GraphView: Context menu -> Delete
  GraphView-->>App: onNodeDelete({ id, parentId })
  App->>jsonParser: removeNode(graph, id)
  jsonParser-->>App: updated graph
```

## Notes
- External hybrid knowledge graph integrations (Neo4j/Qdrant/Postgres) are **not performed** because external network/stateful writes are disallowed in this environment; architecture kept local.
- The plan prioritizes stable layout by persisting Cytoscape positions and minimizing full relayouts.
```
