# Architecture Plan (2026-01-05 21:25:46 UTC)

## Repository Snapshot (Abstracted AST Overview)
- **App (`jsonic/src/App.tsx`)**
  - State: `currentView`, `graph: JsonGraph`, `textContent`, `currentFile`, `status`, `selectedNodeId`.
  - Graph callbacks: handles node select/edit/create/delete/move and updates text via `graphToJson`.
  - Utilities from `utils/jsonParser`: `addChildNode`, `findNode`, `moveNode`, `removeNode`, `updateNode`, `graphToJson`, `jsonToGraph`.
- **GraphView (`jsonic/src/components/GraphView.tsx`)**
  - Uses Cytoscape; renders nodes/edges derived from `JsonGraph`.
  - Emits structured callbacks for select/edit/create/delete/move, keyboard navigation, context menu, drag reparenting, viewport/position updates.
  - Edges currently omit `type` data in element payloads (inline comment notes traversal relies on `edge[type="parent"]`).
- **jsonParser utilities (`jsonic/src/utils/jsonParser.ts`)**
  - Helpers for conversion plus `addChildNode`, `addEdge`, `removeNode`, `moveNode`, `updateNode`, `findNode`.
  - `moveNode` lacks guard against assigning a node under its own descendant (could create cycle).
- **Docs**
  - Architecture and checklist files stored under `docs/ARCHITECTURE` and `docs/CHECKLISTS`.

## Required Changes (per review feedback)
1. **Cytoscape edge typing**
   - When building edge elements in `GraphView.tsx`, include `type` in `data` so selectors like `edge[type="parent"]` work for navigation.
2. **Guard reparenting cycles**
   - In `moveNode` (`jsonParser.ts`), prevent moving a node under itself or any descendant. If attempted, skip mutation.
3. **Safety updates**
   - Ensure resulting graph remains connected and positions preserved where provided.

## Approach
- Update `GraphView` edge mapping to attach `type` field from `JsonGraph.edges`.
- Enhance `moveNode` with descendant check using DFS from candidate parent to ensure `nodeId` not reachable.
- Run build to validate TypeScript.

## Notes
- External hybrid knowledge graph persistence endpoints provided but not used here due to environment constraints; architecture recorded locally.
